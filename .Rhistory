dlabel <- 87
routeMap <- dperiod %>%
filter(LabelNum ==  dlabel) %>%
group_by(LabelNum,DIR) %>%
mutate(halfseq = max(LINKSEQ1) / 2) %>%
mutate(color = ifelse(LINKSEQ1 <= halfseq, "blue","red")) %>%
ungroup() %>%
#filter(LINKSEQ1 < halfseq) %>%
st_as_sf %>% st_transform(4326)
utaStops <- uta_points %>%
filter(PkOk == finalPeriod) %>%
filter(DIR %in% finalDir) %>%
filter(LabelNum == dlabel)
leaflet() %>%
addProviderTiles(providers$CartoDB.Positron) %>%
addCircleMarkers(lng = utaStops$lon, lat = utaStops$lat,
popup = paste("Avgmphdwell: ",utaStops$Avgmphdwell, "<br>",
"STOP1: ", utaStops$STOP, "<br>",
"STOP2: ", utaStops$STOP2),
color = "red",
radius = 8,
group = "UTA Stops") %>%
addPolylines(
data = routeMap$geometry,
color = routeMap$color,
#weight = routeMap$speedRatio*10,
group = "TDM Links",
popup = paste("MODE:", routeMap$MODE, "<br>",
"ONEWAY:", routeMap$ONEWAY, "<br>",
"LINKSEQ1:", routeMap$LINKSEQ1, "<br>",
"LINKSEQ2:", routeMap$LINKSEQ2, "<br>",
"P_SPEED1:", routeMap$P_SPEED1, "<br>",
"P_SPEED2:", routeMap$P_SPEED2, "<br>",
"O_SPEED1:", routeMap$O_SPEED1, "<br>",
"O_SPEED2:", routeMap$O_SPEED2, "<br>",
"EstAvgmphdwell", routeMap$EstAvgmphdwell, "<br>",
"speedRatio:", routeMap$speedRatio)
) %>%
addLayersControl(
overlayGroups =c("TDM Links", "UTA Stops"),
options = layersControlOptions(collapsed=FALSE)
)
finalDir <- 92
dlabel <- 87
dlabel <- 92
routeMap <- dperiod %>%
filter(LabelNum ==  dlabel) %>%
group_by(LabelNum,DIR) %>%
mutate(halfseq = max(LINKSEQ1) / 2) %>%
mutate(color = ifelse(LINKSEQ1 <= halfseq, "blue","red")) %>%
ungroup() %>%
#filter(LINKSEQ1 < halfseq) %>%
st_as_sf %>% st_transform(4326)
utaStops <- uta_points %>%
filter(PkOk == finalPeriod) %>%
filter(DIR %in% finalDir) %>%
filter(LabelNum == dlabel)
leaflet() %>%
addProviderTiles(providers$CartoDB.Positron) %>%
addCircleMarkers(lng = utaStops$lon, lat = utaStops$lat,
popup = paste("Avgmphdwell: ",utaStops$Avgmphdwell, "<br>",
"STOP1: ", utaStops$STOP, "<br>",
"STOP2: ", utaStops$STOP2),
color = "red",
radius = 8,
group = "UTA Stops") %>%
addPolylines(
data = routeMap$geometry,
color = routeMap$color,
#weight = routeMap$speedRatio*10,
group = "TDM Links",
popup = paste("MODE:", routeMap$MODE, "<br>",
"ONEWAY:", routeMap$ONEWAY, "<br>",
"LINKSEQ1:", routeMap$LINKSEQ1, "<br>",
"LINKSEQ2:", routeMap$LINKSEQ2, "<br>",
"P_SPEED1:", routeMap$P_SPEED1, "<br>",
"P_SPEED2:", routeMap$P_SPEED2, "<br>",
"O_SPEED1:", routeMap$O_SPEED1, "<br>",
"O_SPEED2:", routeMap$O_SPEED2, "<br>",
"EstAvgmphdwell", routeMap$EstAvgmphdwell, "<br>",
"speedRatio:", routeMap$speedRatio)
) %>%
addLayersControl(
overlayGroups =c("TDM Links", "UTA Stops"),
options = layersControlOptions(collapsed=FALSE)
)
dlabel <- 94
routeMap <- dperiod %>%
filter(LabelNum ==  dlabel) %>%
group_by(LabelNum,DIR) %>%
mutate(halfseq = max(LINKSEQ1) / 2) %>%
mutate(color = ifelse(LINKSEQ1 <= halfseq, "blue","red")) %>%
ungroup() %>%
#filter(LINKSEQ1 < halfseq) %>%
st_as_sf %>% st_transform(4326)
utaStops <- uta_points %>%
filter(PkOk == finalPeriod) %>%
filter(DIR %in% finalDir) %>%
filter(LabelNum == dlabel)
leaflet() %>%
addProviderTiles(providers$CartoDB.Positron) %>%
addCircleMarkers(lng = utaStops$lon, lat = utaStops$lat,
popup = paste("Avgmphdwell: ",utaStops$Avgmphdwell, "<br>",
"STOP1: ", utaStops$STOP, "<br>",
"STOP2: ", utaStops$STOP2),
color = "red",
radius = 8,
group = "UTA Stops") %>%
addPolylines(
data = routeMap$geometry,
color = routeMap$color,
#weight = routeMap$speedRatio*10,
group = "TDM Links",
popup = paste("MODE:", routeMap$MODE, "<br>",
"ONEWAY:", routeMap$ONEWAY, "<br>",
"LINKSEQ1:", routeMap$LINKSEQ1, "<br>",
"LINKSEQ2:", routeMap$LINKSEQ2, "<br>",
"P_SPEED1:", routeMap$P_SPEED1, "<br>",
"P_SPEED2:", routeMap$P_SPEED2, "<br>",
"O_SPEED1:", routeMap$O_SPEED1, "<br>",
"O_SPEED2:", routeMap$O_SPEED2, "<br>",
"EstAvgmphdwell", routeMap$EstAvgmphdwell, "<br>",
"speedRatio:", routeMap$speedRatio)
) %>%
addLayersControl(
overlayGroups =c("TDM Links", "UTA Stops"),
options = layersControlOptions(collapsed=FALSE)
)
dlabel <- 100
routeMap <- dperiod %>%
filter(LabelNum ==  dlabel) %>%
group_by(LabelNum,DIR) %>%
mutate(halfseq = max(LINKSEQ1) / 2) %>%
mutate(color = ifelse(LINKSEQ1 <= halfseq, "blue","red")) %>%
ungroup() %>%
#filter(LINKSEQ1 < halfseq) %>%
st_as_sf %>% st_transform(4326)
utaStops <- uta_points %>%
filter(PkOk == finalPeriod) %>%
filter(DIR %in% finalDir) %>%
filter(LabelNum == dlabel)
leaflet() %>%
addProviderTiles(providers$CartoDB.Positron) %>%
addCircleMarkers(lng = utaStops$lon, lat = utaStops$lat,
popup = paste("Avgmphdwell: ",utaStops$Avgmphdwell, "<br>",
"STOP1: ", utaStops$STOP, "<br>",
"STOP2: ", utaStops$STOP2),
color = "red",
radius = 8,
group = "UTA Stops") %>%
addPolylines(
data = routeMap$geometry,
color = routeMap$color,
#weight = routeMap$speedRatio*10,
group = "TDM Links",
popup = paste("MODE:", routeMap$MODE, "<br>",
"ONEWAY:", routeMap$ONEWAY, "<br>",
"LINKSEQ1:", routeMap$LINKSEQ1, "<br>",
"LINKSEQ2:", routeMap$LINKSEQ2, "<br>",
"P_SPEED1:", routeMap$P_SPEED1, "<br>",
"P_SPEED2:", routeMap$P_SPEED2, "<br>",
"O_SPEED1:", routeMap$O_SPEED1, "<br>",
"O_SPEED2:", routeMap$O_SPEED2, "<br>",
"EstAvgmphdwell", routeMap$EstAvgmphdwell, "<br>",
"speedRatio:", routeMap$speedRatio)
) %>%
addLayersControl(
overlayGroups =c("TDM Links", "UTA Stops"),
options = layersControlOptions(collapsed=FALSE)
)
dlabel <- 101
routeMap <- dperiod %>%
filter(LabelNum ==  dlabel) %>%
group_by(LabelNum,DIR) %>%
mutate(halfseq = max(LINKSEQ1) / 2) %>%
mutate(color = ifelse(LINKSEQ1 <= halfseq, "blue","red")) %>%
ungroup() %>%
#filter(LINKSEQ1 < halfseq) %>%
st_as_sf %>% st_transform(4326)
utaStops <- uta_points %>%
filter(PkOk == finalPeriod) %>%
filter(DIR %in% finalDir) %>%
filter(LabelNum == dlabel)
leaflet() %>%
addProviderTiles(providers$CartoDB.Positron) %>%
addCircleMarkers(lng = utaStops$lon, lat = utaStops$lat,
popup = paste("Avgmphdwell: ",utaStops$Avgmphdwell, "<br>",
"STOP1: ", utaStops$STOP, "<br>",
"STOP2: ", utaStops$STOP2),
color = "red",
radius = 8,
group = "UTA Stops") %>%
addPolylines(
data = routeMap$geometry,
color = routeMap$color,
#weight = routeMap$speedRatio*10,
group = "TDM Links",
popup = paste("MODE:", routeMap$MODE, "<br>",
"ONEWAY:", routeMap$ONEWAY, "<br>",
"LINKSEQ1:", routeMap$LINKSEQ1, "<br>",
"LINKSEQ2:", routeMap$LINKSEQ2, "<br>",
"P_SPEED1:", routeMap$P_SPEED1, "<br>",
"P_SPEED2:", routeMap$P_SPEED2, "<br>",
"O_SPEED1:", routeMap$O_SPEED1, "<br>",
"O_SPEED2:", routeMap$O_SPEED2, "<br>",
"EstAvgmphdwell", routeMap$EstAvgmphdwell, "<br>",
"speedRatio:", routeMap$speedRatio)
) %>%
addLayersControl(
overlayGroups =c("TDM Links", "UTA Stops"),
options = layersControlOptions(collapsed=FALSE)
)
dlabel <- 102
routeMap <- dperiod %>%
filter(LabelNum ==  dlabel) %>%
group_by(LabelNum,DIR) %>%
mutate(halfseq = max(LINKSEQ1) / 2) %>%
mutate(color = ifelse(LINKSEQ1 <= halfseq, "blue","red")) %>%
ungroup() %>%
#filter(LINKSEQ1 < halfseq) %>%
st_as_sf %>% st_transform(4326)
utaStops <- uta_points %>%
filter(PkOk == finalPeriod) %>%
filter(DIR %in% finalDir) %>%
filter(LabelNum == dlabel)
leaflet() %>%
addProviderTiles(providers$CartoDB.Positron) %>%
addCircleMarkers(lng = utaStops$lon, lat = utaStops$lat,
popup = paste("Avgmphdwell: ",utaStops$Avgmphdwell, "<br>",
"STOP1: ", utaStops$STOP, "<br>",
"STOP2: ", utaStops$STOP2),
color = "red",
radius = 8,
group = "UTA Stops") %>%
addPolylines(
data = routeMap$geometry,
color = routeMap$color,
#weight = routeMap$speedRatio*10,
group = "TDM Links",
popup = paste("MODE:", routeMap$MODE, "<br>",
"ONEWAY:", routeMap$ONEWAY, "<br>",
"LINKSEQ1:", routeMap$LINKSEQ1, "<br>",
"LINKSEQ2:", routeMap$LINKSEQ2, "<br>",
"P_SPEED1:", routeMap$P_SPEED1, "<br>",
"P_SPEED2:", routeMap$P_SPEED2, "<br>",
"O_SPEED1:", routeMap$O_SPEED1, "<br>",
"O_SPEED2:", routeMap$O_SPEED2, "<br>",
"EstAvgmphdwell", routeMap$EstAvgmphdwell, "<br>",
"speedRatio:", routeMap$speedRatio)
) %>%
addLayersControl(
overlayGroups =c("TDM Links", "UTA Stops"),
options = layersControlOptions(collapsed=FALSE)
)
dlabel <- 103
routeMap <- dperiod %>%
filter(LabelNum ==  dlabel) %>%
group_by(LabelNum,DIR) %>%
mutate(halfseq = max(LINKSEQ1) / 2) %>%
mutate(color = ifelse(LINKSEQ1 <= halfseq, "blue","red")) %>%
ungroup() %>%
#filter(LINKSEQ1 < halfseq) %>%
st_as_sf %>% st_transform(4326)
utaStops <- uta_points %>%
filter(PkOk == finalPeriod) %>%
filter(DIR %in% finalDir) %>%
filter(LabelNum == dlabel)
leaflet() %>%
addProviderTiles(providers$CartoDB.Positron) %>%
addCircleMarkers(lng = utaStops$lon, lat = utaStops$lat,
popup = paste("Avgmphdwell: ",utaStops$Avgmphdwell, "<br>",
"STOP1: ", utaStops$STOP, "<br>",
"STOP2: ", utaStops$STOP2),
color = "red",
radius = 8,
group = "UTA Stops") %>%
addPolylines(
data = routeMap$geometry,
color = routeMap$color,
#weight = routeMap$speedRatio*10,
group = "TDM Links",
popup = paste("MODE:", routeMap$MODE, "<br>",
"ONEWAY:", routeMap$ONEWAY, "<br>",
"LINKSEQ1:", routeMap$LINKSEQ1, "<br>",
"LINKSEQ2:", routeMap$LINKSEQ2, "<br>",
"P_SPEED1:", routeMap$P_SPEED1, "<br>",
"P_SPEED2:", routeMap$P_SPEED2, "<br>",
"O_SPEED1:", routeMap$O_SPEED1, "<br>",
"O_SPEED2:", routeMap$O_SPEED2, "<br>",
"EstAvgmphdwell", routeMap$EstAvgmphdwell, "<br>",
"speedRatio:", routeMap$speedRatio)
) %>%
addLayersControl(
overlayGroups =c("TDM Links", "UTA Stops"),
options = layersControlOptions(collapsed=FALSE)
)
uta_points_clean <- tar_read(uta_points_clean)
View(uta_points_clean)
i
uta_points_clean_fixed <- uta_points_clean %>%
mutate(DIR = case_when(
LabelNum == 12 & STOP > 10 ~ 1,
TRUE ~ DIR
))
uta_points_clean_fixed <- uta_points_clean %>%
mutate(DIR = case_when(
LabelNum == 12 && STOP > 10 ~ 1,
TRUE ~ DIR
))
uta_points_clean_fixed <- uta_points_clean %>%
mutate(DIR = case_when(
LabelNum == 12 && STOP > 10 ~ 1
))
View(uta_points_clean_fixed)
uta_points_clean_fixed <- uta_points_clean %>%
mutate(DIR_fix = case_when(
LabelNum == 12 && STOP > 10 ~ 1,
TRUE ~ NA
))
uta_points_clean_fixed <- uta_points_clean %>%
mutate(DIR_fix = case_when(
LabelNum == 12 && STOP > 10 ~ 1,
TRUE ~ 2
))
View(uta_points_clean_fixed)
uta_points_clean_fixed <- uta_points_clean %>%
mutate(DIR_fix = case_when(
(LabelNum == 12 && STOP > 10) ~ 1,
TRUE ~ 2
))
uta_points_clean_fixed <- uta_points_clean %>%
mutate(DIR_fix = case_when(
(LabelNum == 12 & STOP > 10) ~ 1,
TRUE ~ 2
))
View(uta_points_clean_fixed)
uta_points_clean_fixed <- uta_points_clean %>%
mutate(DIR_fix = case_when(
(LabelNum == 12 & STOP > 10) ~ 1,
TRUE ~ NA
))
uta_points_clean_fixed <- uta_points_clean %>%
mutate(DIR_fix = case_when(
(LabelNum == 12 & STOP > 10) ~ 1,
TRUE ~ 2
))
uta_points_clean_fixed <- uta_points_clean %>%
mutate(DIR_fix = case_when(
(LabelNum == 12 & STOP > 10) ~ 1,
TRUE ~ 2
)) %>%
mutate(DIR = ifelse(DIR_fix != 2, DIR_Fix, DIR))
uta_points_clean_fixed <- uta_points_clean %>%
mutate(DIR_fix = case_when(
(LabelNum == 12 & STOP > 10) ~ 1,
TRUE ~ 2
)) %>%
mutate(DIR = ifelse(DIR_fix != 2, DIR_fix, DIR))
uta_points_clean_fixed <- uta_points_clean %>%
mutate(DIR_fix = case_when(
(LabelNum == 12 & STOP > 10) ~ 1,
TRUE ~ 2
)) %>%
mutate(DIR = ifelse(DIR_fix != 2, DIR_fix, DIR)) %>%
select(-DIR_fix)
uta_points_clean_fixed <- uta_points_clean %>%
mutate(DIR_fix = case_when(
(LabelNum == 12 & STOP > 10) ~ 1,
(LabelNum == 36 & STOP > 21) ~ 1,
(LabelNum == 39 & STOP > 20) ~ 1,
(LabelNum == 43 & STOP > 36) ~ 1,
(LabelNum == 45 & STOP > 35) ~ 1,
(LabelNum == 90 & STOP > 38) ~ 1,
(LabelNum == 93) ~ case_when(
(DIR == 1 & PkOk == "pk" & STOP < 29) ~ 1,
(DIR == 0 & PkOk == "pk" & STOP < 51) ~ 0,
(DIR == 0 & PkOk == "ok" & STOP < 51) ~ 0,
(DIR == 0 & PKOk == "ok" & STOP > 24) ~ 0,
TRUE ~ 2
),
TRUE ~ 2
)) %>%
mutate(DIR = ifelse(DIR_fix != 2, DIR_fix, DIR)) %>%
select(-DIR_fix)
uta_points_clean_fixed <- uta_points_clean %>%
mutate(DIR_fix = case_when(
(LabelNum == 12 & STOP > 10) ~ 1,
(LabelNum == 36 & STOP > 21) ~ 1,
(LabelNum == 39 & STOP > 20) ~ 1,
(LabelNum == 43 & STOP > 36) ~ 1,
(LabelNum == 45 & STOP > 35) ~ 1,
(LabelNum == 90 & STOP > 38) ~ 1,
(LabelNum == 93) ~ case_when(
(DIR == 1 & PkOk == "pk" & STOP < 29) ~ 1,
(DIR == 0 & PkOk == "pk" & STOP < 51) ~ 0,
(DIR == 0 & PkOk == "ok" & STOP < 51) ~ 0,
(DIR == 0 & PkOk == "ok" & STOP > 24) ~ 0,
TRUE ~ 2
),
TRUE ~ 2
)) %>%
mutate(DIR = ifelse(DIR_fix != 2, DIR_fix, DIR)) %>%
select(-DIR_fix)
uta_points_clean_fixed <- uta_points_clean %>%
mutate(DIR_fix = case_when(
(LabelNum == 12 & STOP > 10) ~ 1,
(LabelNum == 36 & STOP > 21) ~ 1,
(LabelNum == 39 & STOP > 20) ~ 1,
(LabelNum == 43 & STOP > 36) ~ 1,
(LabelNum == 45 & STOP > 35) ~ 1,
(LabelNum == 90 & STOP > 38) ~ 1,
(LabelNum == 93) ~ case_when(
(DIR == 1 & PkOk == "pk" & STOP > 29) ~ 3,
(DIR == 0 & PkOk == "pk" & STOP > 51) ~ 3,
(DIR == 0 & PkOk == "ok" & STOP > 51) ~ 3,
(DIR == 0 & PkOk == "ok" & STOP < 24) ~ 3,
TRUE ~ 2
),
TRUE ~ 2
)) %>%
filter(DIR_fix != 3) %>%
mutate(DIR = ifelse(DIR_fix != 2, DIR_fix, DIR)) %>%
select(-DIR_fix)
uta_points_clean_fixed <- uta_points_clean %>%
mutate(DIR_fix = case_when(
(LabelNum == 12 & STOP > 10) ~ 1,
(LabelNum == 36 & STOP > 21) ~ 1,
(LabelNum == 39 & STOP > 20) ~ 1,
(LabelNum == 43 & STOP > 36) ~ 1,
(LabelNum == 45 & STOP > 35) ~ 1,
(LabelNum == 90 & STOP > 38) ~ 1,
(LabelNum == 93) ~ case_when(
(DIR == 1 & PkOk == "pk" & STOP >= 29) ~ 3,
(DIR == 0 & PkOk == "pk" & STOP >= 51) ~ 3,
(DIR == 0 & PkOk == "ok" & STOP >= 51) ~ 3,
(DIR == 0 & PkOk == "ok" & STOP <= 24) ~ 3,
TRUE ~ 2
),
TRUE ~ 2
)) %>%
filter(DIR_fix != 3) %>%
mutate(DIR = ifelse(DIR_fix != 2, DIR_fix, DIR)) %>%
select(-DIR_fix)
tar_make()
pk_0_estimated_speeds <- tar_read(pk_0_estimated_speeds)
View(pk_0_estimated_speeds)
pk_0_segment_speeds <- tar_read(pk_0_segment_speeds)
View(pk_0_segment_speeds)
tar_make()
tar_make()
tar_make()
tar_make()
View(tdm_transit_lines)
tdm_transit_lines_fixed <- tdm_transit_lines %>%
group_by(LabelNum,Label)%>%
mutate(halfseq = max(LINKSEQ1)/2)
View(tdm_transit_lines_fixed)
tdm_transit_lines_fixed <- tdm_transit_lines %>%
group_by(LabelNum,Label)%>%
mutate(halfseq = max(LINKSEQ1)/2) %>%
ungroup() %>%
mutate(Label = case_when(
(LabelNum %in% outnbacklinks & LINKSEQ1 <= halfseq) ~ paste0(Label,"_A"),
(LabelNum %in% outnbacklinks & LINKSEQ1 > halfseq) ~ paste0(Label,"_B"),
TRUE ~ Label
))
outnbacklinks <- c(1,2,3,5,12,15,18,19,26,27,37,41,42,43,45,62,75,77,84,85,87)
tdm_transit_lines_fixed <- tdm_transit_lines %>%
group_by(LabelNum,Label)%>%
mutate(halfseq = max(LINKSEQ1)/2) %>%
ungroup() %>%
mutate(Label = case_when(
(LabelNum %in% outnbacklinks & LINKSEQ1 <= halfseq) ~ paste0(Label,"_A"),
(LabelNum %in% outnbacklinks & LINKSEQ1 > halfseq) ~ paste0(Label,"_B"),
TRUE ~ Label
))
tar_make()
tar_make()
tar_make()
tar_make()
tar_make()
pk_0_estimated_speeds <- tar_read9pk_0_estimated_speeds
pk_0_estimated_speeds <- tar_rea(9pk_0_estimated_speeds)
pk_0_estimated_speeds <- tar_read(pk_0_estimated_speeds)
View(pk_0_estimated_speeds)
centroid_speeds <- uta_on_tdm %>% as.tibble() %>%
group_by(LabelNum,Label,DIR,centroid_id) %>%
arrange(Label,DIR,centroid_id) %>%
#' take average if more than one stop exists
mutate(Avgmph_C = mean(Avgmph),
Avgmphdwell_C = mean(Avgmphdwell)) %>%
filter(!is.na(centroid_id)) %>%
select(centroid_id,LabelNum,Label,DIR,PkOk,STOP,STOP2,Avgmph,Avgmph_C,Avgmphdwell,Avgmphdwell_C)
uta_on_tdm <- tar_read(uta_on_tdm)
pk_0_centroid_speeds <- tar_read(pk_0_centroid_speeds)
View(pk_0_centroid_speeds)
tdm_centroids_clean <- tar_read(tdm_centroids_clean)
View(tdm_centroids_clean)
tar_make()
pk_0_uta_on_tdm <- tar_read(pk_0_uta_on_tdm)
View(pk_0_uta_on_tdm)
View(pk_0_uta_on_tdm)
tar_make()
tar_make()
tar_make()
library(targets)
library(tarchetypes)
library(tidyverse)
tar_make()
pk_0_estimated_speeds <- tar_read(pk_0_estimated_speeds)
View(pk_0_estimated_speeds)
tar_make()
